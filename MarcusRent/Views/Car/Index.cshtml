@model List<MarcusRent.Models.CarViewModel>

@{
    ViewData["Title"] = "Car List";
}

@if (TempData["TempData"] != null)
{
    <div class="alert alert-danger">
        @TempData["TempData"]
    </div>
}



<h1>Car List</h1>

<h3>Dessa bilar är tillgängliga för uthyrning</h3>

<p>
    <a asp-action="Create" class="btn custom-btn">Create New</a>
</p>

<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>ImageGallery</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Year</th>
            <th>Price/Day</th>
            <th>Book</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            var galleryId = "gallery_" + item.CarId;
            <tr>
                <td>
                    @if (item.ImageUrls != null && item.ImageUrls.Any())
                    {
                        <div id="@galleryId" class="position-relative">
                            <img src="@item.ImageUrls[0]" alt="Car Image" class="img-fluid rounded shadow gallery-image" style="max-height:140px; object-fit:cover;" />
                            <button type="button" class="prev-btn">&#10094;</button>
                            <button type="button" class="next-btn">&#10095;</button>
                            <input type="hidden" class="image-urls" value="@string.Join(";", item.ImageUrls)" />
                        </div>


                    
                    }
                    else
                    {
                        <span>No images</span>
                    }
                </td>
                <td>@item.Brand</td>
                <td>@item.Model</td>
                <td>@item.Year</td>
                <td>@item.PricePerDay.ToString("C")</td>

                <td>
                    @* Länk till Order/Create med bilens id som query-param *@
                    <a asp-controller="Order" asp-action="Create" asp-route-carId="@item.CarId" class="btn custom-btn">Boka här</a>
                </td>



               
                @* <td>
                    <a asp-action="Edit" asp-route-id="@item.CarId" class="btn btn-sm btn-warning">Edit</a>
                    <a asp-action="Details" asp-route-id="@item.CarId" class="btn btn-sm btn-info">Details</a>
                    <a asp-action="Delete" asp-route-id="@item.CarId" class="btn btn-sm btn-danger">Delete</a>
                </td> *@
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll('.image-gallery').forEach((gallery, galleryIndex) => {
                const img = gallery.querySelector('img');
                const urls = gallery.querySelector('.image-urls').value.split(';');
                let index = 0;

                const prevBtn = gallery.querySelector('.prev-btn');
                const nextBtn = gallery.querySelector('.next-btn');

                function showImage(i) {
                    if (i < 0) i = urls.length - 1;
                    if (i >= urls.length) i = 0;

                    index = i;
                    img.style.opacity = 0;

                    setTimeout(() => {
                        img.src = urls[index];
                        img.style.opacity = 1;
                    }, 300);
                }

                prevBtn.addEventListener('click', () => {
                    showImage(index - 1);
                });

                nextBtn.addEventListener('click', () => {
                    showImage(index + 1);
                });

                // Automatisk bläddring med individuell startfördröjning
                const initialDelay = galleryIndex * 1000 + Math.random() * 1000;

                setTimeout(() => {
                    setInterval(() => {
                        showImage(index + 1);
                    }, 5000);
                }, initialDelay);
            });
        });
    </script>
}